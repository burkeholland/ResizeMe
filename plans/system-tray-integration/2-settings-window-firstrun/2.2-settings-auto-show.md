# Step 2.2: Auto-Show Settings Window on First Run

**Part of:** Step 2 from plan.md  
**Focus:** Display `SettingsWindow` automatically after initial launch if `FirstRunCompleted` is false; set flag true after window closes.  
**File to Edit:** `ResizeMe/MainWindow.xaml.cs`  
**Estimated Time:** 10 minutes

## Overview
Implements the first-run experience by showing Settings immediately after main window setup and persisting completion state once dismissed.

## Pre-Substep Checklist

- [ ] **Branch:** `system-tray-integration`
- [ ] **Prior Substeps:** 2.1 complete (flag exists), Step 1 complete
- [ ] **Build OK:** `dotnet build ResizeMe.sln`
 - [x] **Branch:** `system-tray-integration`
 - [x] **Prior Substeps:** 2.1 complete (flag exists), Step 1 complete
 - [x] **Build OK:** `dotnet build ResizeMe.sln`

## Implementation

### Goal
Trigger automatic modal-like settings display once per install/user, then mark completion.

### Step-by-Step Instructions

#### Step 1: Add First-Run Check After Load
- [x] In `MainWindow.xaml.cs`, locate where presets are loaded (`Loaded += async ...`). After existing logic, add enqueue for first-run check.

```csharp
Loaded += async (_, _) =>
{
    await _presetManager.LoadAsync();
    LoadPresetButtons();
    DispatcherQueue.TryEnqueue(() => CheckFirstRunAndShowSettings());
};
```

#### Step 2: Add Helper Method
- [x] Add method inside `MainWindow` class:

```csharp
private void CheckFirstRunAndShowSettings()
{
    try
    {
        if (!Services.UserPreferences.FirstRunCompleted)
        {
            var win = new SettingsWindow();
            win.PresetsChanged += OnSettingsPresetsChanged;
            win.Closed += async (_, _) =>
            {
                win.PresetsChanged -= OnSettingsPresetsChanged;
                Services.UserPreferences.FirstRunCompleted = true; // Mark completion
                await _presetManager.LoadAsync(true);
                DispatcherQueue.TryEnqueue(LoadPresetButtons);
            };
            win.Activate();
            StatusText.Text = "First-run settings";
        }
    }
    catch (Exception ex)
    {
        System.Diagnostics.Debug.WriteLine($"First-run settings error: {ex.Message}");
    }
}
```

#### Step 3: Build & Test
- [ ] Save file
- [ ] `dotnet build ResizeMe.sln`
- [ ] Run app (ensure clean state: delete local settings if needed) -> Settings window appears once
- [ ] Close Settings window -> restart app -> Settings should NOT auto-show
 - [x] Save file
 - [x] `dotnet build ResizeMe.sln`
 - [ ] Run app (ensure clean state: delete local settings if needed) -> Settings window appears once
 - [ ] Close Settings window -> restart app -> Settings should NOT auto-show

## Verification Checklist

- [ ] First launch: Settings auto-shows
- [ ] Flag persisted: subsequent launches skip auto-show
- [ ] Presets reload after closing settings
 - [ ] First launch: Settings auto-shows
 - [ ] Flag persisted: subsequent launches skip auto-show
 - [ ] Presets reload after closing settings

## Troubleshooting

| Issue | Solution |
|-------|----------|
| Settings appears every launch | Confirm `UserPreferences.FirstRunCompleted = true;` set in Closed handler |
| Settings never appears | Ensure `DispatcherQueue.TryEnqueue(CheckFirstRunAndShowSettings)` executes (method name correct) |
| Presets not reloaded | Verify `await _presetManager.LoadAsync(true);` in closed handler |

## Files Modified

- [x] âœ… Modified: `ResizeMe/MainWindow.xaml.cs`

## What Comes Next

- Proceed to Step 3: First minimize notification.
