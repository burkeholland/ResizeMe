# Step 2.1: First-Run Preference Flag

**Part of:** Step 2 from plan.md  
**Focus:** Add `FirstRunCompleted` preference to `UserPreferences` for one-time automatic Settings display.  
**File to Edit:** `ResizeMe/Services/UserPreferences.cs`  
**Estimated Time:** 5 minutes

## Overview
Introduces a boolean flag persisted in LocalSettings to determine if the user has completed first-run setup. Defaults to false and becomes true after first settings interaction.

## Pre-Substep Checklist

- [x] **Branch:** `system-tray-integration`
- [x] **Prior Substep:** Step 1 completed
- [x] **Build OK:** `dotnet build ResizeMe.sln`

## Implementation

### Goal
Expose `FirstRunCompleted` with safe get/set semantics matching existing style.

### Step-by-Step Instructions

#### Step 1: Add Constant & Property
- [x] Open `ResizeMe/Services/UserPreferences.cs`
- [x] Below existing `CenterKey` add new constant and property:

```csharp
private const string FirstRunKey = "FirstRunCompleted";

/// <summary>
/// Indicates whether the application has completed the first run experience.
/// </summary>
public static bool FirstRunCompleted
{
    get
    {
        try
        {
            var settings = ApplicationData.Current.LocalSettings;
            if (settings.Values.TryGetValue(FirstRunKey, out var val) && val is bool b)
            {
                return b;
            }
        }
        catch
        {
            // Swallow - do not allow preference errors to crash app.
        }
        return false; // default: not completed
    }
    set
    {
        try
        {
            var settings = ApplicationData.Current.LocalSettings;
            settings.Values[FirstRunKey] = value;
        }
        catch
        {
            // Swallow - ignore save failures
        }
    }
}
```

#### Step 2: Build
- [x] Save file
- [ ] Run `dotnet build ResizeMe.sln`

## Verification Checklist

- [x] Property compiles without errors
- [ ] Launch app -> value defaults to false (debug check optional)
- [ ] Manually set `UserPreferences.FirstRunCompleted = true;` in a scratch spot (temporary) and confirm persistence (optional)

## Troubleshooting

| Issue | Solution |
|-------|----------|
| Build fails (missing namespace) | Ensure `using Windows.Storage;` remains at top |
| Value always false | Confirm LocalSettings accessible; check capability (should be by default) |
| Exception logged | Swallowed; add temporary debug logging if diagnosis needed |

## Files Modified

- [x] âœ… Modified: `ResizeMe/Services/UserPreferences.cs`

## What Comes Next

- Next substep: Step 2.2 - Auto-show Settings window on first run.
