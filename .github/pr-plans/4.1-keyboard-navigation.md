# PR 4.1: Keyboard Navigation

**Branch Name:** `4.1-keyboard-navigation`

**Description:** Add keyboard navigation (Arrow keys, Enter activation, Escape to close) for dynamic preset buttons.

**Technology Stack:** WinUI 3, C#, existing dynamic preset logic.

**Dependencies:** PR 3.4 (dynamic buttons).

**Part of Phase:** Phase 4 – Accessibility & UX improvement.

## Pre-Implementation Checklist

- [ ] Branch setup.
- [ ] Build baseline.

## Implementation Steps

### Step 1: Add Navigation State

**Goal:** Track index of focused preset button.

**File to Edit:** `ResizeMe/MainWindow.xaml.cs`

**Checklist:**
- [ ] Add `_presetIndex` field.
- [ ] Add method `FocusPreset(int index)`.

```csharp
// Field
private int _presetIndex = -1;

private void FocusPreset(int index)
{
    if (DynamicPresetsPanel == null) return;
    var buttons = DynamicPresetsPanel.Children.OfType<Button>().ToList();
    if (!buttons.Any()) return;
    if (index < 0) index = 0;
    if (index >= buttons.Count) index = buttons.Count - 1;
    _presetIndex = index;
    var target = buttons[index];
    target.Focus(FocusState.Programmatic);
}
```

**Verification:** Build ok.

---

### Step 2: Extend Key Handling

**Goal:** Arrow keys navigate; Enter activates selection; Escape hides.

**File to Edit:** `ResizeMe/MainWindow.xaml.cs`

**Checklist:**
- [ ] Modify existing KeyDown handler to include navigation logic.

```csharp
private void OnKeyDown(object sender, Microsoft.UI.Xaml.Input.KeyRoutedEventArgs e)
{
    if (!_isVisible) return;
    var buttons = DynamicPresetsPanel?.Children.OfType<Button>().ToList();
    switch (e.Key)
    {
        case Windows.System.VirtualKey.Escape:
            HideWindow();
            break;
        case Windows.System.VirtualKey.Right:
        case Windows.System.VirtualKey.Down:
            if (buttons != null && buttons.Count > 0) FocusPreset(_presetIndex + 1);
            break;
        case Windows.System.VirtualKey.Left:
        case Windows.System.VirtualKey.Up:
            if (buttons != null && buttons.Count > 0) FocusPreset(_presetIndex - 1);
            break;
        case Windows.System.VirtualKey.Enter:
            if (buttons != null && _presetIndex >= 0 && _presetIndex < buttons.Count)
            {
                buttons[_presetIndex].RaiseEvent(new RoutedEventArgs(Button.ClickEvent));
            }
            break;
    }
}
```

**Verification:** Build & run; test navigation.

---

### Step 3: Initialize Focus On Show

**Goal:** First preset focused when menu appears.

**File to Edit:** `ResizeMe/MainWindow.xaml.cs`

**Checklist:**
- [ ] At end of `LoadPresetButtons()` call `FocusPreset(0);`.

```csharp
// Inside LoadPresetButtons() after generating buttons:
FocusPreset(0);
```

**Verification:** First button focused automatically.

---

### Step 4: Manual Test

**Goal:** Validate full keyboard flow.

**Checklist:**
- [ ] Hotkey show → first button focused.
- [ ] Arrow keys cycle; wrap prevention confirmed.
- [ ] Enter resizes selected window.
- [ ] Escape hides window.

---

## Build and Final Verification

- [ ] Build & run test matrix.

## Expected Behavior After Completion

- [ ] Keyboard-only operation possible.
- [ ] Focus always within available buttons.
\- [ ] Enter triggers resize identical to click.

## Troubleshooting

| Issue | Solution |
|-------|----------|
| Focus not visible | Ensure default Button focus visuals not disabled; test with Tab. |
| Arrow keys ignored | Confirm KeyDown subscribed and window active. |
| Enter does nothing | Verify `_presetIndex` set (focusPreset called). |
| Exception on navigation | Guard against empty collection (already implemented). |

## Files Modified

- [ ] ✅ Modified: `ResizeMe/MainWindow.xaml.cs`

## Commit Message Template

```
feat(accessibility): add keyboard navigation for preset buttons

Implements arrow key traversal, enter activation, and escape hide for floating menu presets.

- Focus management state
- Key handling logic
- Auto-focus initial preset

Refs: Phase 4 PR 4.1
```

## Implementation Notes for Reviewers

- Simple linear navigation chosen—grid layout could allow 2D logic later.
- RaiseEvent used for consistency (single click path).

## What Comes Next

- PR 4.2 adds visual polish and animations.
