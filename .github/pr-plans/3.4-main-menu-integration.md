# PR 3.4: Main Menu Integration

**Branch Name:** `3.4-main-menu-integration`

**Description:** Dynamically load presets from PresetManager into the floating menu, generating buttons at runtime.

**Technology Stack:** WinUI 3, C#, PresetManager, WindowResizer

**Dependencies:** PRs 3.1–3.3 complete (SettingsWindow + persistence + logic).

**Part of Phase:** Phase 3 – Connect customization to core UI.

## Pre-Implementation Checklist

- [x] Branch:
  ```bash
  git checkout main
  git pull
  git checkout -b 3.4-main-menu-integration
  ```
- [x] Build baseline.

## Implementation Steps

### Step 1: Refactor XAML Preset Grid Placeholder

**Goal:** Simplify preset container for dynamic injection.

**File to Edit:** `ResizeMe/MainWindow.xaml`

**Checklist:**
- [x] Replace preset button static grid with empty `ItemsRepeater` or `StackPanel`.
- [x] Paste updated file below (only presets section changed).

```xml
<!-- Replace existing PresetsSection inside content with below -->
<StackPanel x:Name="PresetsSection" Spacing="12">
  <TextBlock Text="Quick Resize" FontWeight="SemiBold" FontSize="16" />
  <StackPanel x:Name="DynamicPresetsPanel" Orientation="Vertical" Spacing="6" />
  <TextBlock x:Name="PresetHint" Text="Customize in Settings" FontSize="11" Opacity="0.7" />
</StackPanel>
```

**Verification:**
- [x] Build—XAML valid.

---

### Step 2: Add Dynamic Button Generation Logic

**Goal:** Generate preset buttons with active highlight and click handlers.

**File to Edit:** `ResizeMe/MainWindow.xaml.cs`

**Checklist:**
- [x] Add method `LoadPresetButtons()`.
- [x] Call after PresetManager load.
- [x] Replace related portions (provide full file section below to insert).

```csharp
// Add field if not present
private readonly ResizeMe.Services.PresetManager _presetManager = new();

// In constructor AFTER InitializeComponent():
Loaded += async (_, _) => { await _presetManager.LoadAsync(); LoadPresetButtons(); };

private void LoadPresetButtons()
{
    if (DynamicPresetsPanel == null) return;
    DynamicPresetsPanel.Children.Clear();
    var baseStyle = (Style?)App.Current.Resources["PresetButtonBaseStyle"];
    var activeStyle = (Style?)App.Current.Resources["ActivePresetButtonStyle"];
    foreach (var preset in _presetManager.Presets)
    {
        var btn = new Button
        {
            Content = new StackPanel
            {
                Orientation = Orientation.Vertical,
                Spacing = 2,
                Children =
                {
                    new TextBlock{Text=preset.Name, FontWeight= Windows.UI.Text.FontWeights.SemiBold, FontSize=14},
                    new TextBlock{Text=$"{preset.Width}×{preset.Height}", Opacity=0.8, FontSize=11}
                }
            },
            Tag = $"{preset.Width}x{preset.Height}",
            Style = baseStyle,
            Height = 48,
            Margin = new Thickness(0,0,0,4)
        };
        btn.Click += PresetButton_Click;
        DynamicPresetsPanel.Children.Add(btn);
    }
    if (!_presetManager.Presets.Any())
    {
        PresetHint.Text = "No presets defined. Add in Settings.";
    }
}

// Update SetActivePreset to handle dynamic panel only (remove old grid iteration if obsolete)
private void SetActivePreset(string sizeTag)
{
    _activePresetTag = sizeTag;
    var activeStyle = (Style?)App.Current.Resources["ActivePresetButtonStyle"];
    var baseStyle = (Style?)App.Current.Resources["PresetButtonBaseStyle"];
    if (DynamicPresetsPanel == null || activeStyle == null || baseStyle == null) return;
    foreach (var child in DynamicPresetsPanel.Children.OfType<Button>())
    {
        if (child.Tag is string tag && tag == sizeTag) child.Style = activeStyle; else child.Style = baseStyle;
    }
}
```

**Verification:**
- [x] Build succeeds.
- [ ] Launch app; hotkey show → dynamic buttons appear.

---

### Step 3: Manual Test Dynamic Behavior

**Goal:** Ensure update after adding preset in Settings.

**Checklist:**
- [ ] Open Settings; add new preset (e.g., 1600x900 Work).
- [ ] Close Settings; re-open menu (hotkey) → new button visible.
- [ ] Click new button → window resizes and active style applied.

**Verification:** Status text shows success.

---

## Build and Final Verification

- [ ] Build and run dynamic loading test.
- [ ] Add/remove presets and confirm UI reflects on next load.

## Expected Behavior After Completion

- [ ] Preset buttons reflect current persisted presets.
- [ ] Active button highlights properly.
- [ ] No orphaned static buttons remain.

## Troubleshooting

| Issue | Solution |
|-------|----------|
| Buttons not appearing | Confirm `LoadPresetButtons` invoked after load (Loaded event). |
| Active style not applied | Check resource keys; ensure SetActivePreset uses DynamicPresetsPanel. |
| Old static buttons visible | Remove original grid from XAML fully. |
| Performance lag | Limit number of presets; confirm synchronous creation acceptable (few items). |

## Files Modified

- [x] ✅ Modified: `ResizeMe/MainWindow.xaml`
- [x] ✅ Modified: `ResizeMe/MainWindow.xaml.cs`

## Commit Message Template

```
feat(presets): integrate dynamic preset buttons into main menu

Generates preset buttons from persistent storage at runtime, replacing static layout and enabling custom sizes.

- Dynamic button generation method
- Active highlight update
- Simplified XAML preset section

Refs: Phase 3 PR 3.4
```

## Implementation Notes for Reviewers

- Simple StackPanel used—scale is low; virtualization unnecessary.
- Future improvement: reorder or categorize presets (grid or WrapPanel).

## What Comes Next

- Phase 4 adds keyboard navigation & polish to dynamic buttons.
